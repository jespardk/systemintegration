@page "/dashboard"
@inject PowerMeasurementsService PowerMeasurementsService
@inject WeatherService WeatherService
@inject CacheService CacheService
@inject TemperatureReportingService TemperatureReportingService

@code {
    private ForecastAggregateResponse _weatherForecast;
    private PowerProductionResponse _powerProduction;
    private TemperatureReportAggregateResponse _temperatureReport;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Ensure this is only triggered on first load - not every time the view is rerendered
            await LoadData();
            Console.WriteLine("First render OK");
        }

        await base.OnAfterRenderAsync(firstRender);
    }

    private async Task LoadData()
    {
        _weatherForecast = await WeatherService.GetForecastAsync();
        await InvokeAsync(() => StateHasChanged());

        _powerProduction = await PowerMeasurementsService.GetMeasurementsAsync();
        await InvokeAsync(() => StateHasChanged());

        _temperatureReport = await TemperatureReportingService.GetTemperatureRecent();
        await InvokeAsync(() => StateHasChanged());
    }
}

<PowerProductionSubview Model="_powerProduction" />

<br />

<TemperatureReportSubview Model="_temperatureReport" />

<br />

<WeatherForecastSubview Model="_weatherForecast" />